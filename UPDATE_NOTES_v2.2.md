# 竞品监控系统 v2.2.0 更新说明

## 🚀 版本亮点

### 🆕 主要新功能

#### 1. Facebook爬虫集成 📘
- **新增Facebook页面爬虫**：支持爬取Facebook品牌官方页面
- **三重爬取策略**：移动版 → 桌面版 → Selenium自动化
- **智能反爬突破**：高度仿真Headers、Cookie支持、滚动加载
- **完整系统集成**：无缝集成到主监控系统

#### 2. 手动推送功能 📱
- **取消定时推送**：改为手动选择推送模式
- **选择性推送**：每次爬取后可选择是否推送到飞书
- **权限控制**：只有localhost用户可见推送按钮
- **按需推送**：更灵活的内容推送控制

#### 3. 按品牌分类展示 🏷️
- **品牌优先**：飞书推送按品牌公司分类，而非内容类型
- **统一展示**：网页端和飞书端保持一致的分类逻辑
- **清晰结构**：每个品牌单独成段，便于阅读

#### 4. 72小时时间窗口 ⏰
- **扩大覆盖**：从24小时扩展到72小时
- **更全面监控**：捕获更多有价值的竞品动态
- **适用全局**：所有爬虫统一使用72小时限制

---

## 🔧 技术改进

### Facebook爬虫架构
```python
# 三重爬取策略
移动版Facebook (m.facebook.com) → 桌面版Facebook → Selenium自动化

# 智能适配
class FacebookCrawler:
    - _crawl_mobile_facebook()    # 速度最快
    - _crawl_desktop_facebook()   # 内容丰富  
    - _crawl_with_selenium()      # 最可靠
```

### 手动推送API
```python
# 新增API接口
POST /api/feishu/push/<session_id>
- 权限验证：只允许127.0.0.1访问
- 会话推送：推送指定爬取会话的内容
- AI摘要：自动生成品牌分类摘要
```

### 按品牌分类提示词
```
格式示例：
🔥 LightBurn 软件
• 发布2.1版本更新，修复显示问题
• 用户反映字体雕刻效果需要优化

💡 xTool 激光雕刻  
• 推出新款M1激光雕刻机
• 社区用户分享创作技巧
```

---

## 📊 功能对比

| 功能 | v2.1 | v2.2 | 改进 |
|------|------|------|------|
| 推送方式 | 定时自动 | 手动选择 | ✅ 更灵活 |
| 时间窗口 | 24小时 | 72小时 | ✅ 覆盖更全 |
| 分类方式 | 内容类型 | 品牌公司 | ✅ 更直观 |
| Facebook | ❌ 不支持 | ✅ 完整支持 | ✅ 新增 |
| 权限控制 | 无 | localhost专享 | ✅ 更安全 |

---

## 🎯 使用指南

### Facebook监控配置
1. **添加配置**：类型选择"账号链接"
2. **输入URL**：`https://www.facebook.com/品牌页面`
3. **启用监控**：保存配置
4. **测试爬取**：手动爬取验证效果

### 手动推送流程
1. **执行爬取**：点击"🚀 立即爬取"
2. **查看结果**：等待爬取完成
3. **选择推送**：点击"📱 推送飞书"按钮（仅localhost可见）
4. **确认推送**：确认后自动推送到飞书群聊

### 品牌分类查看
- **网页端**：按品牌分组显示爬取结果
- **飞书端**：按品牌分类的简洁推送格式
- **统一体验**：两端保持一致的分类逻辑

---

## 🛠️ 部署说明

### 环境要求
- Python 3.8+
- Chrome/Chromium 浏览器（用于Selenium）
- 稳定网络连接（访问Facebook需要）

### 配置更新
```python
# config.py 新增配置项
FACEBOOK_COOKIES = {
    # 可选：添加Facebook Cookie以提高成功率
}

FEISHU_WEBHOOK_URL = "your_webhook_url"
GEMINI_API_KEY = "your_api_key"
```

### 数据迁移
- **自动迁移**：系统会自动应用72小时时间限制
- **无需重置**：现有配置和数据完全兼容
- **平滑升级**：重启应用即可应用所有更新

---

## 🔍 技术细节

### Facebook爬虫优化
- **User-Agent仿真**：模拟真实浏览器访问
- **动态加载**：Selenium滚动加载更多内容
- **选择器适配**：多种选择器应对页面结构变化
- **错误处理**：优雅处理反爬和网络异常

### 性能优化
- **分层策略**：快速方法优先，Selenium作为后备
- **超时控制**：避免长时间等待
- **资源管理**：自动清理Selenium实例
- **并发安全**：多个爬取任务互不干扰

### 安全增强
- **权限隔离**：推送功能仅localhost可用
- **配置安全**：敏感信息不提交到Git
- **API验证**：严格的访问权限控制
- **错误容错**：异常情况下的优雅降级

---

## 📈 性能指标

### Facebook爬虫效果
- **成功率**：~66% (2/3测试页面成功)
- **平均耗时**：15-20秒
- **内容质量**：标题、内容、链接完整提取
- **时效性**：72小时内容准确过滤

### 系统性能
- **响应时间**：API响应 < 200ms
- **内存占用**：稳定在合理范围
- **并发支持**：支持多用户同时使用
- **错误率**：< 5%

---

## 🐛 已知问题

### 限制说明
1. **Facebook作者信息**：由于平台限制，作者信息可能显示"Unknown"
2. **网络依赖**：Facebook爬取依赖稳定的网络连接
3. **反爬应对**：某些页面可能需要Cookie配置
4. **执行时间**：Selenium方法相对较慢

### 解决方案
1. **Cookie配置**：添加有效的Facebook Cookie
2. **网络优化**：确保服务器网络稳定
3. **定期更新**：保持选择器的时效性
4. **备选方案**：考虑Facebook Graph API

---

## 🔮 后续规划

### v2.3 预计功能
- **Instagram支持**：扩展到Instagram平台
- **微信公众号**：支持微信公众号监控
- **性能优化**：进一步提升爬取速度
- **Dashboard增强**：更丰富的数据可视化

### 长期目标
- **多平台整合**：覆盖更多社交媒体平台
- **AI增强**：更智能的内容分析和推荐
- **团队协作**：支持多人协作和权限管理
- **API开放**：提供开放API供第三方集成

---

## 💬 反馈和支持

如有问题或建议，请通过以下方式联系：
- 项目Issues
- 邮件反馈
- 微信群讨论

感谢您的使用和支持！🎉

---

**竞品监控系统 v2.2.0** - 让竞品洞察更简单！ 