{% extends "base.html" %}

{% block title %}å¿«é€Ÿè®¾ç½®å‘å¯¼ - é£ä¹¦è‡ªåŠ¨æ¨é€æœºå™¨äºº{% endblock %}

{% block extra_css %}
<style>
.wizard-container {
    max-width: 800px;
    margin: 0 auto;
}

.wizard-step {
    display: none;
    animation: fadeIn 0.5s;
}

.wizard-step.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.step-indicator {
    display: flex;
    justify-content: center;
    margin-bottom: 30px;
}

.step-indicator .step {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: #e9ecef;
    color: #6c757d;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 10px;
    font-weight: bold;
    position: relative;
}

.step-indicator .step.active {
    background-color: #007bff;
    color: white;
}

.step-indicator .step.completed {
    background-color: #28a745;
    color: white;
}

.step-indicator .step:not(:last-child)::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 100%;
    width: 20px;
    height: 2px;
    background-color: #e9ecef;
    transform: translateY(-50%);
}

.step-indicator .step.completed:not(:last-child)::after {
    background-color: #28a745;
}

.example-box {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 15px;
    margin: 15px 0;
}

.example-box h6 {
    color: #495057;
    margin-bottom: 10px;
}

.config-preview {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 15px;
    font-family: monospace;
    font-size: 14px;
    white-space: pre-line;
}
</style>
{% endblock %}

{% block page_title %}
<i class="fas fa-magic text-primary"></i>
å¿«é€Ÿè®¾ç½®å‘å¯¼
{% endblock %}

{% block content %}
<div class="wizard-container">
    <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
    <div class="step-indicator">
        <div class="step active" data-step="1">1</div>
        <div class="step" data-step="2">2</div>
        <div class="step" data-step="3">3</div>
        <div class="step" data-step="4">4</div>
        <div class="step" data-step="5">5</div>
    </div>

    <!-- æ­¥éª¤1: æ¬¢è¿ -->
    <div class="wizard-step active" id="step-1">
        <div class="text-center">
            <h2>ğŸ‰ æ¬¢è¿ä½¿ç”¨é£ä¹¦è‡ªåŠ¨æ¨é€æœºå™¨äºº</h2>
            <p class="lead">è®©æˆ‘ä»¬ç”¨5ä¸ªç®€å•æ­¥éª¤æ¥é…ç½®æ‚¨çš„ç³»ç»Ÿ</p>
            
            <div class="row mt-4">
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-robot fa-3x text-primary mb-3"></i>
                            <h5>æ™ºèƒ½ç›‘æ§</h5>
                            <p>è‡ªåŠ¨ç›‘æ§ç½‘ç«™åŠ¨æ€ï¼Œç²¾å‡†æ•è·ç›¸å…³å†…å®¹</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-paper-plane fa-3x text-success mb-3"></i>
                            <h5>è‡ªåŠ¨æ¨é€</h5>
                            <p>å®æ—¶æ¨é€åˆ°é£ä¹¦ç¾¤èŠå’Œå¤šç»´è¡¨æ ¼</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-clock fa-3x text-warning mb-3"></i>
                            <h5>å®šæ—¶ä»»åŠ¡</h5>
                            <p>çµæ´»çš„å®šæ—¶ç­–ç•¥ï¼Œ24å°æ—¶è‡ªåŠ¨è¿è¡Œ</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <button class="btn btn-primary btn-lg" onclick="nextStep()">
                    å¼€å§‹é…ç½® <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- æ­¥éª¤2: é£ä¹¦æœºå™¨äººé…ç½® -->
    <div class="wizard-step" id="step-2">
        <h3><i class="fas fa-robot text-primary"></i> é…ç½®é£ä¹¦æœºå™¨äºº</h3>
        
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            <strong>è¯´æ˜ï¼š</strong>é£ä¹¦æœºå™¨äººæ˜¯æ¨é€æ¶ˆæ¯çš„æ ¸å¿ƒï¼Œå¿…é¡»æ­£ç¡®é…ç½®æ‰èƒ½æ¥æ”¶æ¨é€ã€‚
        </div>

        <div class="example-box">
            <h6><i class="fas fa-lightbulb text-warning"></i> å¦‚ä½•è·å–Webhook URLï¼Ÿ</h6>
            <ol>
                <li>æ‰“å¼€é£ä¹¦ç¾¤èŠï¼Œç‚¹å‡»å³ä¸Šè§’è®¾ç½®æŒ‰é’®</li>
                <li>é€‰æ‹©"ç¾¤æœºå™¨äºº" â†’ "æ·»åŠ æœºå™¨äºº"</li>
                <li>é€‰æ‹©"è‡ªå®šä¹‰æœºå™¨äºº"</li>
                <li>è®¾ç½®æœºå™¨äººåç§°ï¼š<code>å†…å®¹æ¨é€åŠ©æ‰‹</code></li>
                <li>å¤åˆ¶ç”Ÿæˆçš„Webhook URL</li>
            </ol>
        </div>

        <form id="feishu-form">
            <div class="mb-3">
                <label for="webhook-url" class="form-label">
                    <i class="fas fa-link"></i> Webhook URL <span class="text-danger">*</span>
                </label>
                <input type="url" class="form-control" id="webhook-url" 
                       placeholder="https://open.feishu.cn/open-apis/bot/v2/hook/..."
                       required>
                <div class="form-text">è¿™æ˜¯é£ä¹¦æœºå™¨äººçš„Webhookåœ°å€ï¼Œå¿…å¡«é¡¹</div>
            </div>

            <div class="mb-3">
                <label for="webhook-secret" class="form-label">
                    <i class="fas fa-key"></i> Webhookå¯†é’¥ <span class="text-muted">(å¯é€‰)</span>
                </label>
                <input type="text" class="form-control" id="webhook-secret" 
                       placeholder="å¦‚æœå¼€å¯äº†ç­¾åéªŒè¯ï¼Œè¯·å¡«å…¥å¯†é’¥">
                <div class="form-text">å¦‚æœåˆ›å»ºæœºå™¨äººæ—¶å¼€å¯äº†ç­¾åéªŒè¯ï¼Œè¯·å¡«å…¥å¯†é’¥</div>
            </div>

            <div class="mb-3">
                <button type="button" class="btn btn-outline-primary" onclick="testWebhook()">
                    <i class="fas fa-vial"></i> æµ‹è¯•è¿æ¥
                </button>
                <small class="text-muted ms-2">ç‚¹å‡»æµ‹è¯•æœºå™¨äººæ˜¯å¦é…ç½®æ­£ç¡®</small>
            </div>
        </form>

        <div class="d-flex justify-content-between mt-4">
            <button class="btn btn-outline-secondary" onclick="prevStep()">
                <i class="fas fa-arrow-left"></i> ä¸Šä¸€æ­¥
            </button>
            <button class="btn btn-primary" onclick="nextStep()" id="step2-next" disabled>
                ä¸‹ä¸€æ­¥ <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <!-- æ­¥éª¤3: ç›‘æ§ç½‘ç«™é…ç½® -->
    <div class="wizard-step" id="step-3">
        <h3><i class="fas fa-globe text-success"></i> é…ç½®ç›‘æ§ç½‘ç«™</h3>
        
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            <strong>è¯´æ˜ï¼š</strong>é€‰æ‹©è¦ç›‘æ§çš„ç½‘ç«™ç±»å‹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é…ç½®æœ€ä½³çš„çˆ¬å–ç­–ç•¥ã€‚
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="card website-type-card" data-type="product" onclick="selectWebsiteType('product')">
                    <div class="card-body text-center">
                        <i class="fas fa-box fa-3x text-primary mb-3"></i>
                        <h5>äº§å“ç½‘ç«™</h5>
                        <p>ç›‘æ§äº§å“åŠ¨æ€ã€ç‰ˆæœ¬æ›´æ–°ã€ç”¨æˆ·åé¦ˆ</p>
                        <small class="text-muted">æ¨èï¼šWeCreateã€GitHubç­‰</small>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card website-type-card" data-type="social" onclick="selectWebsiteType('social')">
                    <div class="card-body text-center">
                        <i class="fas fa-users fa-3x text-info mb-3"></i>
                        <h5>ç¤¾äº¤åª’ä½“</h5>
                        <p>ç›‘æ§å¾®åšã€çŸ¥ä¹ã€å°çº¢ä¹¦ç­‰å¹³å°</p>
                        <small class="text-muted">æ¨èï¼šå¾®åšã€çŸ¥ä¹ç­‰</small>
                    </div>
                </div>
            </div>
        </div>

        <div id="website-config" class="mt-4" style="display: none;">
            <h5>ç½‘ç«™è¯¦ç»†é…ç½®</h5>
            <form id="website-form">
                <div class="mb-3">
                    <label for="website-name" class="form-label">ç½‘ç«™åç§°</label>
                    <input type="text" class="form-control" id="website-name" placeholder="ä¾‹å¦‚ï¼šWeCreateå®˜ç½‘" required>
                </div>
                <div class="mb-3">
                    <label for="website-url" class="form-label">ç½‘ç«™åœ°å€</label>
                    <input type="url" class="form-control" id="website-url" placeholder="https://www.example.com" required>
                </div>
            </form>
        </div>

        <div class="d-flex justify-content-between mt-4">
            <button class="btn btn-outline-secondary" onclick="prevStep()">
                <i class="fas fa-arrow-left"></i> ä¸Šä¸€æ­¥
            </button>
            <button class="btn btn-primary" onclick="nextStep()" id="step3-next" disabled>
                ä¸‹ä¸€æ­¥ <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <!-- æ­¥éª¤4: å…³é”®è¯é…ç½® -->
    <div class="wizard-step" id="step-4">
        <h3><i class="fas fa-tags text-warning"></i> è®¾ç½®ç›‘æ§å…³é”®è¯</h3>
        
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            <strong>è¯´æ˜ï¼š</strong>è®¾ç½®è¦ç›‘æ§çš„å…³é”®è¯ï¼Œç³»ç»Ÿå°†åªæ¨é€åŒ…å«è¿™äº›å…³é”®è¯çš„å†…å®¹ã€‚
        </div>

        <div class="mb-3">
            <label class="form-label">é€‰æ‹©é¢„è®¾å…³é”®è¯ç±»å‹</label>
            <div class="row" id="keyword-categories">
                <!-- åŠ¨æ€ç”Ÿæˆå…³é”®è¯åˆ†ç±» -->
            </div>
        </div>

        <div class="mb-3">
            <label for="custom-keywords" class="form-label">è‡ªå®šä¹‰å…³é”®è¯</label>
            <textarea class="form-control" id="custom-keywords" rows="3" 
                      placeholder="è¾“å…¥è‡ªå®šä¹‰å…³é”®è¯ï¼Œæ¯è¡Œä¸€ä¸ª&#10;ä¾‹å¦‚ï¼š&#10;äººå·¥æ™ºèƒ½&#10;æœºå™¨å­¦ä¹ &#10;æ·±åº¦å­¦ä¹ "></textarea>
            <div class="form-text">æ¯è¡Œè¾“å…¥ä¸€ä¸ªå…³é”®è¯</div>
        </div>

        <div class="example-box">
            <h6><i class="fas fa-lightbulb text-warning"></i> å…³é”®è¯å»ºè®®</h6>
            <p>ä¸ºäº†è·å¾—æ›´ç²¾å‡†çš„ç»“æœï¼Œå»ºè®®ï¼š</p>
            <ul>
                <li>ä½¿ç”¨å…·ä½“çš„è¯æ±‡ï¼Œé¿å…è¿‡äºå®½æ³›</li>
                <li>åŒ…å«å“ç‰Œåã€äº§å“å</li>
                <li>æ·»åŠ è¡Œä¸šç›¸å…³æœ¯è¯­</li>
                <li>è€ƒè™‘åŒä¹‰è¯å’Œå˜ä½“</li>
            </ul>
        </div>

        <div class="d-flex justify-content-between mt-4">
            <button class="btn btn-outline-secondary" onclick="prevStep()">
                <i class="fas fa-arrow-left"></i> ä¸Šä¸€æ­¥
            </button>
            <button class="btn btn-primary" onclick="nextStep()">
                ä¸‹ä¸€æ­¥ <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <!-- æ­¥éª¤5: å®Œæˆé…ç½® -->
    <div class="wizard-step" id="step-5">
        <h3><i class="fas fa-check-circle text-success"></i> é…ç½®å®Œæˆ</h3>
        
        <div class="alert alert-success">
            <i class="fas fa-check-circle"></i>
            <strong>æ­å–œï¼</strong>æ‚¨å·²æˆåŠŸå®ŒæˆåŸºç¡€é…ç½®ã€‚ç³»ç»Ÿå°†æ ¹æ®æ‚¨çš„è®¾ç½®å¼€å§‹å·¥ä½œã€‚
        </div>

        <div class="row">
            <div class="col-md-6">
                <h5>é…ç½®æ‘˜è¦</h5>
                <div class="config-preview" id="config-summary">
                    <!-- åŠ¨æ€ç”Ÿæˆé…ç½®æ‘˜è¦ -->
                </div>
            </div>
            <div class="col-md-6">
                <h5>ä¸‹ä¸€æ­¥æ“ä½œ</h5>
                <div class="list-group">
                    <div class="list-group-item">
                        <i class="fas fa-play text-success"></i>
                        <strong>ç«‹å³æµ‹è¯•</strong> - æ‰‹åŠ¨è§¦å‘çˆ¬å–ä»»åŠ¡
                    </div>
                    <div class="list-group-item">
                        <i class="fas fa-clock text-primary"></i>
                        <strong>è®¾ç½®å®šæ—¶ä»»åŠ¡</strong> - é…ç½®è‡ªåŠ¨çˆ¬å–è®¡åˆ’
                    </div>
                    <div class="list-group-item">
                        <i class="fas fa-chart-line text-info"></i>
                        <strong>æŸ¥çœ‹ä»ªè¡¨æ¿</strong> - ç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <button class="btn btn-success btn-lg" onclick="finishWizard()">
                <i class="fas fa-rocket"></i> å®Œæˆè®¾ç½®å¹¶å¼€å§‹ä½¿ç”¨
            </button>
        </div>

        <div class="mt-3 text-center">
            <small class="text-muted">æ‚¨å¯ä»¥éšæ—¶åœ¨è®¾ç½®é¡µé¢ä¿®æ”¹è¿™äº›é…ç½®</small>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let currentStep = 1;
let wizardData = {
    feishu: {},
    website: {},
    keywords: []
};

function nextStep() {
    if (validateCurrentStep()) {
        const steps = document.querySelectorAll('.wizard-step');
        const indicators = document.querySelectorAll('.step-indicator .step');
        
        // éšè—å½“å‰æ­¥éª¤
        steps[currentStep - 1].classList.remove('active');
        indicators[currentStep - 1].classList.remove('active');
        indicators[currentStep - 1].classList.add('completed');
        
        // æ˜¾ç¤ºä¸‹ä¸€æ­¥éª¤
        currentStep++;
        steps[currentStep - 1].classList.add('active');
        indicators[currentStep - 1].classList.add('active');
        
        // åˆå§‹åŒ–æ­¥éª¤ç‰¹å®šå†…å®¹
        initializeStep(currentStep);
    }
}

function prevStep() {
    if (currentStep > 1) {
        const steps = document.querySelectorAll('.wizard-step');
        const indicators = document.querySelectorAll('.step-indicator .step');
        
        // éšè—å½“å‰æ­¥éª¤
        steps[currentStep - 1].classList.remove('active');
        indicators[currentStep - 1].classList.remove('active');
        
        // æ˜¾ç¤ºä¸Šä¸€æ­¥éª¤
        currentStep--;
        steps[currentStep - 1].classList.add('active');
        indicators[currentStep - 1].classList.remove('completed');
        indicators[currentStep - 1].classList.add('active');
    }
}

function validateCurrentStep() {
    switch (currentStep) {
        case 1:
            return true;
        case 2:
            return validateFeishuConfig();
        case 3:
            return validateWebsiteConfig();
        case 4:
            return validateKeywordConfig();
        case 5:
            return true;
        default:
            return false;
    }
}

function validateFeishuConfig() {
    const webhookUrl = document.getElementById('webhook-url').value;
    if (!webhookUrl) {
        showToast('è¯·å¡«å…¥Webhook URL', 'error');
        return false;
    }
    
    wizardData.feishu = {
        webhook_url: webhookUrl,
        webhook_secret: document.getElementById('webhook-secret').value
    };
    
    return true;
}

function validateWebsiteConfig() {
    const websiteName = document.getElementById('website-name').value;
    const websiteUrl = document.getElementById('website-url').value;
    
    if (!websiteName || !websiteUrl) {
        showToast('è¯·å®Œæ•´å¡«å†™ç½‘ç«™ä¿¡æ¯', 'error');
        return false;
    }
    
    return true;
}

function validateKeywordConfig() {
    // æ”¶é›†å…³é”®è¯
    const customKeywords = document.getElementById('custom-keywords').value
        .split('\n')
        .map(k => k.trim())
        .filter(k => k.length > 0);
    
    const selectedCategories = Array.from(document.querySelectorAll('.keyword-category.active'))
        .map(el => el.dataset.keywords.split(','))
        .flat();
    
    wizardData.keywords = [...selectedCategories, ...customKeywords];
    
    if (wizardData.keywords.length === 0) {
        showToast('è¯·è‡³å°‘è®¾ç½®ä¸€ä¸ªå…³é”®è¯', 'error');
        return false;
    }
    
    return true;
}

function testWebhook() {
    const webhookUrl = document.getElementById('webhook-url').value;
    const webhookSecret = document.getElementById('webhook-secret').value;
    
    if (!webhookUrl) {
        showToast('è¯·å…ˆå¡«å…¥Webhook URL', 'error');
        return;
    }
    
    // å‘é€æµ‹è¯•æ¶ˆæ¯
    fetch('/api/test-webhook', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            webhook_url: webhookUrl,
            webhook_secret: webhookSecret
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast('è¿æ¥æµ‹è¯•æˆåŠŸï¼', 'success');
            document.getElementById('step2-next').disabled = false;
        } else {
            showToast('è¿æ¥æµ‹è¯•å¤±è´¥ï¼š' + data.message, 'error');
        }
    })
    .catch(error => {
        showToast('æµ‹è¯•å¤±è´¥ï¼š' + error.message, 'error');
    });
}

function selectWebsiteType(type) {
    // ç§»é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
    document.querySelectorAll('.website-type-card').forEach(card => {
        card.classList.remove('border-primary', 'bg-light');
    });
    
    // é€‰ä¸­å½“å‰å¡ç‰‡
    const selectedCard = document.querySelector(`[data-type="${type}"]`);
    selectedCard.classList.add('border-primary', 'bg-light');
    
    // æ˜¾ç¤ºç½‘ç«™é…ç½®è¡¨å•
    document.getElementById('website-config').style.display = 'block';
    document.getElementById('step3-next').disabled = false;
    
    // æ ¹æ®ç±»å‹é¢„å¡«ä¸€äº›ä¿¡æ¯
    if (type === 'product') {
        document.getElementById('website-name').placeholder = 'ä¾‹å¦‚ï¼šWeCreateå®˜ç½‘';
        document.getElementById('website-url').placeholder = 'https://www.wecreat.com';
        wizardData.website.type = 'product';
    } else if (type === 'social') {
        document.getElementById('website-name').placeholder = 'ä¾‹å¦‚ï¼šå¾®åš';
        document.getElementById('website-url').placeholder = 'https://weibo.com';
        wizardData.website.type = 'social';
    }
}

function initializeStep(step) {
    switch (step) {
        case 4:
            initializeKeywordCategories();
            break;
        case 5:
            generateConfigSummary();
            break;
    }
}

function initializeKeywordCategories() {
    const categories = {
        'äº§å“ç›¸å…³': ['äº§å“æ›´æ–°', 'æ–°åŠŸèƒ½', 'ç‰ˆæœ¬å‘å¸ƒ', 'äº§å“åŠ¨æ€'],
        'æŠ€æœ¯ç›¸å…³': ['æŠ€æœ¯æ›´æ–°', 'API', 'å¼€å‘', 'é›†æˆ'],
        'ç”¨æˆ·åé¦ˆ': ['ç”¨æˆ·åé¦ˆ', 'è¯„ä»·', 'å»ºè®®', 'é—®é¢˜åé¦ˆ'],
        'ç«å“åˆ†æ': ['ç«å“', 'å¯¹æ¯”', 'å¸‚åœºåˆ†æ', 'è¡Œä¸šåŠ¨æ€']
    };
    
    const container = document.getElementById('keyword-categories');
    container.innerHTML = '';
    
    Object.entries(categories).forEach(([category, keywords]) => {
        const col = document.createElement('div');
        col.className = 'col-md-6 mb-3';
        
        col.innerHTML = `
            <div class="card keyword-category" data-keywords="${keywords.join(',')}" onclick="toggleKeywordCategory(this)">
                <div class="card-body text-center">
                    <h6>${category}</h6>
                    <small class="text-muted">${keywords.join(', ')}</small>
                </div>
            </div>
        `;
        
        container.appendChild(col);
    });
}

function toggleKeywordCategory(element) {
    element.classList.toggle('active');
    element.classList.toggle('border-primary');
    element.classList.toggle('bg-light');
}

function generateConfigSummary() {
    const summary = `
é£ä¹¦æœºå™¨äººé…ç½®ï¼š
- Webhook URL: ${wizardData.feishu.webhook_url}
- ç­¾åéªŒè¯: ${wizardData.feishu.webhook_secret ? 'å·²å¯ç”¨' : 'æœªå¯ç”¨'}

ç›‘æ§ç½‘ç«™é…ç½®ï¼š
- ç½‘ç«™åç§°: ${wizardData.website.name || 'æœªè®¾ç½®'}
- ç½‘ç«™åœ°å€: ${wizardData.website.url || 'æœªè®¾ç½®'}
- ç½‘ç«™ç±»å‹: ${wizardData.website.type || 'æœªè®¾ç½®'}

å…³é”®è¯é…ç½®ï¼š
- å…³é”®è¯æ•°é‡: ${wizardData.keywords.length}
- å…³é”®è¯åˆ—è¡¨: ${wizardData.keywords.join(', ')}
    `;
    
    document.getElementById('config-summary').textContent = summary;
}

function finishWizard() {
    // æäº¤é…ç½®
    fetch('/api/setup-wizard/complete', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(wizardData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast('é…ç½®ä¿å­˜æˆåŠŸï¼å³å°†è·³è½¬åˆ°ä»ªè¡¨æ¿...', 'success');
            setTimeout(() => {
                window.location.href = '/';
            }, 2000);
        } else {
            showToast('ä¿å­˜é…ç½®å¤±è´¥ï¼š' + data.message, 'error');
        }
    })
    .catch(error => {
        showToast('ä¿å­˜å¤±è´¥ï¼š' + error.message, 'error');
    });
}

// é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ˜¯å¦æœ‰å·²ä¿å­˜çš„é…ç½®
document.addEventListener('DOMContentLoaded', function() {
    // å¯ä»¥åœ¨è¿™é‡ŒåŠ è½½å·²æœ‰çš„é…ç½®
});
</script>
{% endblock %} 